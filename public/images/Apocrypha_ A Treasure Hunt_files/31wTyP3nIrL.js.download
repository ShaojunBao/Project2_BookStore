(function(d){var g=window.AmazonUIPageJS||window.P,l=g._namespace||g.attributeErrors,c=l?l("StarlingInterestGroupAssignment",""):g;c.guardFatal?c.guardFatal(d)(c,window):c.execute(function(){d(c,window)})})(function(d,g,l){d.now("StarlingIGConfiguration").execute(function(c){c||d.register("StarlingIGConfiguration",function(){function a(){return navigator.userAgent}var h=/chrome|chromium|crios/i,b=/opr\//i,e=/edg/i;return{getRoboticSessionId:function(){return"000-0000000-0000000"},getToken:function(a){switch(a){case "gamma":return"A+qAAwo/s1iDqc/hfoGSql86NR2wqWsxKIUj8+Zl/KP9ErZQwRM3HhdY1Q39N1bAueSVZZ+92xFH69iddkTxZwEAAACJeyJvcmlnaW4iOiJodHRwczovL3ByZS1wcm9kLmFtYXpvbi5jb206NDQzIiwiZmVhdHVyZSI6IlByaXZhY3lTYW5kYm94QWRzQVBJcyIsImV4cGlyeSI6MTY5NTE2Nzk5OSwiaXNTdWJkb21haW4iOnRydWUsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0\x3d";
case "prod":return"A69tl2WjpmRBbEqXW1MOXcXGrvFyLn/bow90s5sv6cViJ1eGQCytat/+fYLyCa0i/5O88qtcfMU9MMRZH5RSPAcAAACEeyJvcmlnaW4iOiJodHRwczovL3d3dy5hbWF6b24uY29tOjQ0MyIsImZlYXR1cmUiOiJQcml2YWN5U2FuZGJveEFkc0FQSXMiLCJleHBpcnkiOjE2OTUxNjc5OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"}},generateGatewayUrl:function(a){switch(a){case "beta":return"https://at-"+a+".amazon-adsystem.com";case "gamma":return"https://at-"+a+"-us-east.amazon-adsystem.com";case "prod":return"https://at-us-east.amazon-adsystem.com"}},
isChrome:function(){var f=a(),n=!1;f&&(f.match(h)&&(n=!0),f.match(b)?n=!1:f.match(e)&&(n=!1));return n},getUserAgent:a,getApnPrivacySetting:function(){if(null!==document&&null!==document.cookie){var a=document.cookie.match(/(^| )apn-privacy=([^;]+)/);if(a)return"true"===a[2]}return!1},provideToken:function(a){if(null!==document&&null!==document.head){var b=document.createElement("meta");b.httpEquiv="origin-trial";b.content=a;document.head.appendChild(b)}}}})});"use strict";d.now("StarlingAddMetric").execute(function(c){c||
d.register("StarlingAddMetric",function(){return{addMetric:function(a,h){g.ue&&g.ue.count&&g.ue.count(a,h)}}})});"use strict";d.now("StarlingLogError").execute(function(c){c||d.register("StarlingLogError",function(){return{logError:function(a){var h={logLevel:2<arguments.length&&arguments[2]!==l?arguments[2]:"ERROR",attribution:"StarlingInterestGroupAssignment",message:1<arguments.length&&arguments[1]!==l?arguments[1]:""};g.ueLogError&&g.ueLogError(a,h);return[a,h]}}})});"use strict";d.now("StarlingIGJoinHelpers").execute(function(c){c||
d.when("StarlingIGHelpers","StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingUtils").register("StarlingIGJoinHelpers",function(a,h,b,e,f){function c(a,k,m){var c=0,h=0,d=[];m.forEach(function(a){d.push(new Promise(function(b,e){try{f.getNavigator().joinAdInterestGroup(a,30*f.SECONDS_PER_DAY),b(a)}catch(p){e(p)}}))});return Promise.allSettled(d).then(function(a){var e=[];a.forEach(function(a){"fulfilled"===a.status?(c+=1,e.push(a.value.name)):h+=1});b.addMetric("Starling:BrowserAddedToIG:True",
c);b.addMetric("Starling:BrowserAddedToIG:False",h);f.getCustomerId()?b.addMetric("Starling:IGAssigned:AmazonCustomer",c):(f.getSessionId(),b.addMetric("Starling:IGAssigned:AmazonGuest",c))}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);e.logError(a,"Starling:PromiseResolveError. Error resolving IGJoinPromiseArray.")})}function d(h,d){return a.listInterestGroups(h+"join/",d).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",1);return a.json()}).then(function(b){var e=
a.parseIGMetadataFromResponse(b),k=b.throttleTimeForNextRequest,m=new Date;b=[];e&&0!==e.length&&b.push(c(h,{identity:d.identity},e));k&&(e=0==k?0:Number(k)+m.getTime(),f.addToLocalStorage("timestampForNextJoinRequest",e));return Promise.all(b)}).catch(function(a){a instanceof TypeError?(b.addMetric("Starling:FailedToFetchError",1),e.logError(a,"Starling:FailedToFetchError. Error making fetch request.")):(b.addMetric("Starling:ParseGatewayResponseError",1),e.logError(a,"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway."))})}
return{browserSupportsAdInterestGroup:function(){return"joinAdInterestGroup"in navigator&&document.featurePolicy.allowsFeature("join-ad-interest-group")},joinAdInterestGroups:function(a,e){e=h.generateGatewayUrl(e)+"/interestGroups/";var c=f.lookupLocalStorage("timestampForNextJoinRequest");c=c?Number(c):0;if(0!==c&&c>(new Date).getTime())b.addMetric("Starling:ThrottledIGJoinRequests",1);else return d(e,a)},TIMESTAMP_FOR_NEXT_REQUEST_KEY:"timestampForNextJoinRequest"}})});"use strict";d.now("StarlingInterestGroupAssign").execute(function(c){c||
(d.register("StarlingInterestGroupAssign",function(){var a={init:function(c,b,e,f,d){a.config=c;a.joinHelpers=f;a.metrics=b;a.errors=e;a.utils=d;c=a.config.getRoboticSessionId();b=a.utils.getHref();a.config.isChrome()&&(b?(b=a.utils.getStage(b),e=a.config.getToken(b),a.config.provideToken(e),a.assignIG(b,c)):(a.metrics.addMetric("Starling:PageLoadError",1),a.errors.logError({message:"Starling:PageLoadError. Error retreiving url from window."})))},assignIG:function(c,b){if(a.joinHelpers.browserSupportsAdInterestGroup()){a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:True",
1);var e=a.utils.lookupLocalStorage("csm:adb"),f=!1;null!=e&&e.endsWith("yes")?(f=!0,a.metrics.addMetric("Starling:AdBlockEnabled:True",1)):a.metrics.addMetric("Starling:AdBlockEnabled:False",1);var d=a.utils.getWindowOpts();if(d&&!f){f=a.utils.getSessionId();e=d.pageType;d=d.asin;var h=a.config.getApnPrivacySetting(),g=a.utils.getHref();b=f===b;var k=a.utils.getCustomerId();h||b?a.metrics.addMetric("Starling:TotalPunts",1):a.joinHelpers.joinAdInterestGroups({identity:{customerId:k,sessionId:f},pageInformation:{pageURL:g,
pageType:e,asins:[d]}},c);h&&a.metrics.addMetric("Starling:UserOptedOut:True",1);b&&a.metrics.addMetric("Starling:RoboticTraffic:True",1);a.utils.getCustomerId()?a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonCustomer",1):a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonGuest",1)}else d||(a.metrics.addMetric("Starling:OptsNotFoundError",1),a.errors.logError({message:"Starling:OptsNotFoundError. Error getting windowOpts."}))}else a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:False",
1)}};return a}),d.when("StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingIGJoinHelpers","StarlingInterestGroupAssign","StarlingUtils","ready").execute(function(a,c,b,e,d,g){d.init(a,c,b,e,g)}))});"use strict";d.now("StarlingIGLeaveHelpers").execute(function(c){c||d.when("StarlingIGHelpers","StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingUtils").register("StarlingIGLeaveHelpers",function(a,c,b,e,d){function f(c,f,h){var g=0,k=0,m=[],l=c+"left/";h.forEach(function(a){m.push(new Promise(function(b,
e){try{var c={name:a.name,owner:a.owner};d.getNavigator().leaveAdInterestGroup(c);b(c)}catch(q){e(q)}}))});return Promise.allSettled(m).then(function(c){var h=[];c.forEach(function(a){"fulfilled"===a.status?(g+=1,h.push(a.value.name)):k+=1});b.addMetric("Starling:BrowserRemovedFromIG:True",g);b.addMetric("Starling:BrowserRemovedFromIG:False",k);if(d.getCustomerId())return b.addMetric("Starling:IGRemoved:AmazonCustomer",g),f.interestGroupNames=h,a.setInterestGroups(l,f).catch(function(a){b.addMetric("Starling:SetInterestGroupsLeftError",
1);e.logError(a,"Starling:SetInterestGroupsLeftError. Error Setting Interest Groups Left.")});if(d.getSessionId())return b.addMetric("Starling:IGRemoved:AmazonGuest",g),f.interestGroupNames=h,a.setInterestGroups(l,f).catch(function(a){b.addMetric("Starling:SetInterestGroupsLeftError",1);e.logError(a,"Starling:SetInterestGroupsLeftError. Error Setting Interest Groups Left.")});b.addMetric("Starling:IGRemoved:AmazonGuest",g)}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);e.logError(a,
"Starling:PromiseResolveError. Error resolving IGLeavePromiseArray.")})}function h(c,g){var m=c+"leave/",k=JSON.parse(d.lookupLocalStorage("leaveNextToken"));k&&new Date<k.expiry?g.nextToken=k.token:delete g.nextToken;return a.listInterestGroups(m,g).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",1);return a.json()}).then(function(b){var e=a.parseIGMetadataFromResponse(b),k=b.throttleTimeForNextRequest,m=new Date,l=[];e&&0!==e.length&&l.push(f(c,{identity:g.identity},e));b.nextToken?
(d.addToLocalStorage("leaveNextToken",JSON.stringify({token:b.nextToken,expiry:m.setTime(m.getTime()+144E5)})),l.push(h(c,g))):d.removeFromLocalStorage("leaveNextToken");k&&(b=0==k?0:Number(k)+m.getTime(),d.addToLocalStorage("timestampForNextLeaveRequest",b));return Promise.all(l)}).catch(function(a){a instanceof TypeError?(b.addMetric("Starling:FailedToFetchError",1),e.logError(a,"Starling:FailedToFetchError. Error making fetch request.")):(b.addMetric("Starling:ParseGatewayResponseError",1),e.logError(a,
"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway."))})}return{leaveAdInterestGroups:function(a,e){e=c.generateGatewayUrl(e)+"/interestGroups/";var f=d.lookupLocalStorage("timestampForNextLeaveRequest");f=f?Number(f):0;if(0!==f&&f>(new Date).getTime())b.addMetric("Starling:ThrottledIGLeaveRequests",1);else return a.maxResults=100,h(e,a)},TIMESTAMP_FOR_NEXT_REQUEST_KEY:"timestampForNextLeaveRequest"}})});"use strict";d.now("StarlingUtils").execute(function(c){c||d.register("StarlingUtils",
function(){function a(){return g.opts}var c=/development|beta/,b=/pre-prod|gamma/;return{lookupLocalStorage:function(a){try{return g.localStorage.getItem(a)}catch(f){return null}},addToLocalStorage:function(a,b){try{a=String(a),b=String(b),g.localStorage.setItem(a,b)}catch(n){}},removeFromLocalStorage:function(a){try{g.localStorage.getItem(a)!==l&&g.localStorage.removeItem(a)}catch(f){}},getHref:function(){return g.location.href},getWindowOpts:a,getCustomerId:function(){return a().customerId},getStage:function(a){return c.test(a)?
"beta":b.test(a)?"gamma":"prod"},getNavigator:function(){return navigator},getSessionId:function(){return a().sessionId},SECONDS_PER_DAY:86400}})});"use strict";d.now("StarlingIGHelpers").execute(function(c){c||d.when("StarlingAddMetric","StarlingLogError").register("StarlingIGHelpers",function(a,c){return{parseIGMetadataFromResponse:function(b){if(b){if((b=b.interestGroups)&&Array.isArray(b)&&0<b.length)return a.addMetric("Starling:AttemptedIGAdd",b.length),b;a.addMetric("Starling:GatewayReturnedIGMetadata:False",
1);c.logError({message:"Starling:GatewayReturnedIGMetadata:False. IG Metadata from Gateway is empty or incorrect format."});return null}a.addMetric("Starling:NullGatewayResponseError",1);c.logError({message:"Starling:NullGatewayResponseError. Null IGMetadata response from Gateway."});return null},setInterestGroups:function(a,c){return fetch(a,{method:"POST",body:JSON.stringify(c),credentials:"include"})},listInterestGroups:function(a,c){return fetch(a,{method:"PUT",body:JSON.stringify(c),credentials:"include"})}}})})});